

# gitops-status-checker


  ## Description

  A helper Chart that creates a job to verify if the deployments of an operator are running. To do so it creates a service account with a role to read the status of the Deployments.

This chart is used the check the installation status of an Operator.
Whenever a new Operator gets installed, this Chart can be called to verify if the status of the Operator is ready.
This is useful when you want to install an Operator AND configure it in the same Helm Chart. Typically, Argo CD will fail in such case,
because it would try to configure the CRD that the Operator provides immediately after the Subscription object becomes ready. However,
the CRD is not available yet, since the Operator is still installing itself.

helper-status-checker will create a Service Account (incl. a ClusterRole and a ClusterRoleBinding) and a Job that will try to check the status of the Operator. If the Operator is not available after some time (configurable with mx_retries), the Job will fail.

NOTE: This chart can also be used to automatically approve an InstallPlan


# Parameters

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| approver | bool | false | Enable automatic approval of an InstallPlan. Useful if the installation must be approved manually and you want to initially deploy the Operator using GitOps. |
| checks[0] | object | `{"maxretries":20,"namespace":{"name":"openshift-logging"},"operatorName":"name-of-operator","serviceAccount":{"name":"status-checker"},"sleeptimer":20,"subscriptionName":"name-of-subscription","syncwave":0}` | Name of operator to check. Use the value of the currentCSV (packagemanifest) but WITHOUT the version !! |
| checks[0].maxretries | int | 20 | Maximum number of retries before the checks will fail |
| checks[0].namespace | object | `{"name":"openshift-logging"}` | Namespace where the status-checker Job shall be scheduled. |
| checks[0].serviceAccount.name | string | `"status-checker"` | Name of the Service Account. |
| checks[0].sleeptimer | int | 20 | If the Operator is not yet ready wait this amount of seconds. |
| checks[0].subscriptionName | string | `"name-of-subscription"` | OPTIONAL: Name of subscription that shall be approved. In some cases the name of the Subscription is different to the name of the operator. @default --operatorName |
| checks[0].syncwave | int | 0 | Syncwave for the status-check Job. 0 is the recommended value. |
| enabled | bool | false | Enable or disable the status-checker configuration |

## Example

```yaml
---
enabled: true
approver: true

checks:
  - operatorName: name-of-operator

    sleeptimer: 20
    maxretries: 20

    namespace:
      name: openshift-logging
    syncwave: 3

    serviceAccount:
      name: "status-checker"
```

## Installing the Chart

To install the chart with the release name `my-release`:

```console
helm install my-release tsavr/<chart-name>>
```

The command deploys the chart on the Kubernetes cluster in the default configuration.

## Uninstalling the Chart

To uninstall/delete the my-release deployment:

```console
helm delete my-release
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.12.0](https://github.com/norwoodj/helm-docs/releases/v1.12.0)
